/****
 * Grapnel.js
 * https://github.com/EngineeringMode/Grapnel.js
 *
 * @author Greg Sabia Tucker
 * @link http://artificer.io
 * @version 0.4.2
 *
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
 * forked by Wicker Wings https://github.com/heporap/Grapnel.js */
(function(a){function b(){"use strict";var a=this;return this.events={},this.params=[],this.state=null,this.version="0.4.2",this.anchor={defaultHash:window.location.hash,get:function(){return window.location.hash?window.location.hash.split("#")[1]:""},set:function(b){return window.location.hash=b?b:"",a},clear:function(){return this.set(!1)},reset:function(){return this.set(this.defaultHash)}},this._forEach=function(a,b){return"function"==typeof Array.prototype.forEach?Array.prototype.forEach.call(a,b):function(a,b){for(var c=0,d=this.length;d>c;++c)a.call(b,this[c],c,this)}.call(a,b)},this.trigger=function(b){var c=Array.prototype.slice.call(arguments,1);return this.events[b]&&this._forEach(this.events[b],function(b){b.apply(a,c)}),this},"function"==typeof window.onhashchange&&this.on("hashchange",window.onhashchange),window.onhashchange=function(){a.trigger("hashchange")},this.trigger("initialized")}b.regexRoute=function(a,b,c,d){return a instanceof RegExp?a:(a instanceof Array&&(a="("+a.join("|")+")"),a=a.concat(d?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)"),new RegExp("^"+a+"$",c?"":"i"))},b.prototype.get=b.prototype.add=function(a,c){var d=this,e=[],f=b.regexRoute(a,e),g=function(){var b=d.anchor.get().match(f);if(b){var g={route:a,value:d.anchor.get(),handler:c,params:d.params,regex:b,propagateEvent:!0,previousState:d.state,preventDefault:function(){this.propagateEvent=!1}};if(d.trigger("match",g),!g.propagateEvent)return d;d.state=g;var h={params:{},keys:e,matches:g.regex.slice(1)};d._forEach(h.matches,function(a,b){var c=e[b]&&e[b].name?e[b].name:b;h.params[c]=a?decodeURIComponent(a):void 0}),c.call(d,h,g)}return d};return g().on("initialized hashchange",g)},b.prototype.on=b.prototype.bind=function(a,b){var c=this,d=a.split(" ");return this._forEach(d,function(a){c.events[a]?c.events[a].push(b):c.events[a]=[b]}),this},b.Router=b.prototype.router=b,b.prototype.context=function(a){var b=this;return function(c,d){var e="/"!==a.slice(-1)?a+"/":a,f=e+c;return b.get.call(b,f,d)}},b.listen=function(a){return function(){for(var b in a)this.get.call(this,b,a[b]);return this}.call(new b)},"function"==typeof a.define?a.define("Grapnel",function(){return b}):"object"==typeof exports?exports.Grapnel=b:a.Grapnel=b}).call({},window);